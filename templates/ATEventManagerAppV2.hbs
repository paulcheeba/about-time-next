<section class="at-emv2 at-dracula">
  <style>
    :root { --atd-bg:#282a36; --atd-panel:#1e1f29; --atd-surface:#2b2e3b; --atd-fg:#f8f8f2; --atd-muted:#bd93f9;
            --atd-accent:#6272a4; --atd-green:#50fa7b; --atd-red:#ff5555; --atd-orange:#ffb86c; --atd-yellow:#f1fa8c; --atd-cyan:#8be9fd; --atd-pink:#ff79c6; }

    .at-dracula { color: var(--atd-fg); }
    .at-dracula input, .at-dracula select, .at-dracula textarea {
      background: var(--atd-surface); color: var(--atd-fg); border: 1px solid var(--atd-accent);
    }

    /* Layout (minimal) */
    .at-emv2 { min-width: 920px; }
    .at-emv2 .row { display:flex; align-items:center; gap:.5rem; margin:.25rem 0; }
    .at-emv2 label { min-width:120px; color:var(--atd-fg); }
    .at-emv2 input[type="text"], .at-emv2 input[type="search"] { width:100%; }

    /* Button row should not cut off: allow wrapping, don't force wide input */
    .at-emv2 .row.buttons { flex-wrap: wrap; }
    .at-emv2 .row.buttons input[type="text"] { width:auto; flex:0 0 auto; }
    .at-emv2 .row.buttons button { flex:0 0 auto; }

    .at-emv2 table { width:100%; border-collapse:collapse; background:var(--atd-panel) }
    .at-emv2 th, .at-emv2 td { padding:.45rem; border-bottom:1px solid var(--atd-accent) }
    .at-emv2 th { color:var(--atd-yellow) }
    .at-emv2 .muted { opacity:.9; color:var(--atd-muted); font-size:.9em }
    .at-emv2 hr { border:none; border-top:1px solid var(--atd-accent); margin:.5rem 0 }

    /* Buttons */
    .at-btn { display:inline-block; padding:.35rem .6rem; border-radius:.5rem; border:1px solid var(--atd-accent);
              background:var(--atd-surface); color:var(--atd-fg); line-height:1; white-space:nowrap }
    .at-btn:hover { filter:brightness(1.1) }
    .at-btn.primary { border-color:var(--atd-green); box-shadow:0 0 0 1px var(--atd-green) inset }
    .at-btn.warn    { border-color:var(--atd-orange); box-shadow:0 0 0 1px var(--atd-orange) inset }
    .at-btn.danger  { border-color:var(--atd-red);    box-shadow:0 0 0 1px var(--atd-red) inset }

    .board-title { margin:.25rem 0 .5rem; color:var(--atd-yellow); font-weight:600; }
  </style>

  <div class="controls">
    <div class="row">
      <label>Event Name</label>
      <input type="text" name="eventName" placeholder="Short name (used for stop-by-name)" />
    </div>
    <div class="row">
      <label>Duration</label>
      <input type="text" name="duration" placeholder="e.g. 1h30m, 45s, 2d 4h" />
      <span class="muted">Format accepts d/h/m/s in any order.</span>
    </div>
    <div class="row">
      <label>Message</label>
      <input type="text" name="message" placeholder="GM whisper or macro arg" />
    </div>
    <div class="row">
      <label>Options</label>
      <label><input type="checkbox" name="repeat" /> Repeat</label>
      <label><input type="checkbox" name="runMacro" /> Run Macro</label>
      <input type="text" name="macroName" placeholder="Macro Name" />
    </div>
    <div class="row buttons">
      {{#if isGM}}
      <button type="button" class="at-btn primary" data-action="create">Create</button>
      <input type="text" name="stopKey" placeholder="Stop → enter Name or UID" />
      <button type="button" class="at-btn warn" data-action="stop-by-name">Stop by Name</button>
      <button type="button" class="at-btn warn" data-action="stop-by-uid">Stop by UID</button>
      <button type="button" class="at-btn" data-action="list">Send Queue to Chat</button>
      <button type="button" class="at-btn danger" data-action="flush">Stop all Events</button>
      <button type="button" class="at-btn danger" data-action="flush-rem">Stop all + 1h reminder</button>
      {{else}}
      <span class="muted">Players can view the queue only.</span>
      {{/if}}
    </div>
  </div>

  <hr />

  <h3 class="board-title">Event Status Board</h3>
  <div class="queue">
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Starts</th>
          <th>Remaining</th>
          <th>Repeat</th>
          <th>Message</th>
          <th>UID</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {{#if entries.length}}
          {{#each entries as |e|}}
          <tr data-uid="{{e.uid}}">
            <td class="name">{{e.name}}</td>
            <td class="start">{{e.startTxt}}</td>
            <td class="remain"><span data-remaining data-time="{{e.time}}">{{e.remainingTxt}}</span></td>
            <td class="repeat">{{#if e.recurring}}Yes ({{e.incTxt}}){{else}}—{{/if}}</td>
            <td class="msg">{{e.msg}}</td>
            <td class="uid"><code>{{e.uid}}</code></td>
            <td class="actions">
              {{#if ../isGM}}<button type="button" class="at-btn warn" data-action="row-stop" data-uid="{{e.uid}}">Stop</button>{{/if}}
              <button type="button" class="at-btn" data-action="copy-uid" data-uid="{{e.uid}}">Copy UID</button>
            </td>
          </tr>
          {{/each}}
        {{else}}
          <tr><td colspan="7" class="muted">- (empty queue) -</td></tr>
        {{/if}}
      </tbody>
    </table>
  </div>
</section>
