<!-- File: modules/about-time-v13/templates/ATEventManagerAppV2.hbs -->
<!-- v13.1.3.0 — Light mode accents (auto-only); no behavior change -->

<section class="at-emv2 at-dracula">
  <style>
    :root { --atd-bg:#282a36; --atd-panel:#1e1f29; --atd-surface:#2b2e3b; --atd-fg:#f8f8f2; --atd-muted:#bd93f9;
            --atd-accent:#6272a4; --atd-green:#50fa7b; --atd-red:#ff5555; --atd-orange:#ffb86c; --atd-yellow:#f1fa8c; --atd-cyan:#8be9fd; --atd-pink:#ff79c6; }
    .at-dracula { color: var(--atd-fg); }
    .at-dracula input, .at-dracula select, .at-dracula textarea {
      background: var(--atd-surface); color: var(--atd-fg); border: 1px solid var(--atd-accent);
    }

    .at-emv2 .row{display:flex;gap:.5rem;align-items:center;margin:.25rem 0}
    .at-emv2 label{min-width:120px;color:var(--atd-fg)}
    .at-emv2 input[type="text"], .at-emv2 input[type="search"]{width:100%}
    .at-emv2 table{width:100%;border-collapse:collapse;background:var(--atd-panel)}
    .at-emv2 th, .at-emv2 td{padding:.45rem;border-bottom:1px solid var(--atd-accent)}
    .at-emv2 th{color:var(--atd-yellow)}
    .at-emv2 .muted{opacity:.9;color:var(--atd-muted);font-size:.9em}
    .at-emv2 hr{border:none;border-top:1px solid var(--atd-accent);margin:.5rem 0}

    .at-btn{display:inline-block;padding:.35rem .6rem;border-radius:.5rem;border:1px solid var(--atd-accent);background:var(--atd-surface);
            color:var(--atd-fg);line-height:1;white-space:nowrap}
    .at-btn:hover{filter:brightness(1.1)}
    .at-btn.primary{border-color:var(--atd-green);box-shadow:0 0 0 1px var(--atd-green) inset}
    .at-btn.warn{border-color:var(--atd-orange);box-shadow:0 0 0 1px var(--atd-orange) inset}
    .at-btn.danger{border-color:var(--atd-red);box-shadow:0 0 0 1px var(--atd-red) inset}

    /* Event Status Board framing */
    .board { border:1px solid var(--atd-accent); border-radius:8px; padding:.5rem; overflow-x:auto; }
    .board-title { margin: .25rem .25rem .5rem; color: var(--atd-yellow); font-weight: 600; }
    /* v13.1.3.0 — Light theme (auto) accents only; keep dark mode as-is */
    .theme-light .at-emv2 .at-btn.primary { border-color:#2e7d32; box-shadow:0 0 0 1px #2e7d32 inset; }
    .theme-light .at-emv2 .at-btn.warn    { border-color:#ef6c00; box-shadow:0 0 0 1px #ef6c00 inset; }
    .theme-light .at-emv2 .at-btn.danger  { border-color:#b71c1c; box-shadow:0 0 0 1px #b71c1c inset; }
    .theme-light .at-emv2 .board-title,
    .theme-light .at-emv2 thead th        { color:#5d4037; }
    /* Inputs/labels: inherit Theme V2; ensure readable text */
    .theme-light .at-emv2 label { color: var(--color-text-primary, #222); }
    .theme-light .at-emv2 input,
    .theme-light .at-emv2 select,
    .theme-light .at-emv2 textarea { background: var(--input-background, #fff); color: var(--input-text-color, #222); border-color: var(--input-border-color, #999); }
  </style>

  <div class="controls">
    <div class="row">
      <label>Event Name</label>
      <input type="text" name="eventName" placeholder="Short name (used for stop-by-name)" />
    </div>
    <div class="row">
      <label>Duration</label>
      <input type="text" name="duration" placeholder="e.g. 1h30m, 45s, 2d 4h" />
      <span class="muted">Format accepts d/h/m/s in any order.</span>
    </div>
    <div class="row">
      <label>Message</label>
      <input type="text" name="message" placeholder="GM whisper or macro arg" />
    </div>
    <div class="row">
      <label>Options</label>
      <label><input type="checkbox" name="repeat" /> Repeat</label>
      <label><input type="checkbox" name="runMacro" /> Run Macro</label>
      <input type="text" name="macroName" placeholder="Macro Name" list="atn-em-macro-list" />
      <datalist id="atn-em-macro-list"></datalist>
      <button type="button" class="at-emv2-btn icon at-emv2-macro-refresh" title="Refresh macros" aria-label="Refresh macros">⟳</button>
    </div>
    <div class="row buttons">
      {{#if isGM}}
      <button type="button" class="at-btn primary" data-action="create">Create</button>
      <input type="text" name="stopKey" placeholder="Stop → enter Name or UID" />
      <button type="button" class="at-btn warn" data-action="stop-by-name">Stop by Name</button>
      <button type="button" class="at-btn warn" data-action="stop-by-uid">Stop by UID</button>
      <button type="button" class="at-btn" data-action="list">Send Queue to Chat</button>
      <button type="button" class="at-btn danger" data-action="flush">Stop all Events</button>
      <button type="button" class="at-btn danger" data-action="flush-rem">Stop all + 1h reminder</button>
      {{else}}
      <span class="muted">Players can view the queue only.</span>
      {{/if}}
    </div>
  </div>

  <hr />

  <div class="board">
    <h3 class="board-title">Event Status Board</h3>
    <div class="queue">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Starts</th>
            <th>Remaining</th>
            <th>Repeat</th>
            <th>Macro</th>
            <th>Message</th>
            <th>UID</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {{#if entries.length}}
            {{#each entries as |e|}}
            <tr data-uid="{{e.uid}}">
              <td class="name">{{e.name}}</td>
              <td class="start">{{e.startTxt}}</td>
              <td class="remain"><span data-remaining data-time="{{e.time}}">{{e.remainingTxt}}</span></td>
              <td class="repeat">{{#if e.recurring}}Yes ({{e.incTxt}}){{else}}—{{/if}}</td>
              <td class="macro" title="{{e.macroUuid}}">{{#if e.macroName}}{{e.macroName}}{{else}}NA{{/if}}</td>
              <td class="msg">{{e.msg}}</td>
              <td class="uid"><code>{{e.uid}}</code></td>
              <td class="actions">
                {{#if ../isGM}}<button type="button" class="at-btn warn" data-action="row-stop" data-uid="{{e.uid}}">Stop</button>{{/if}}
                <!-- Copy UID button removed by request -->
              </td>
            </tr>
            {{/each}}
          {{else}}
            <tr><td colspan="8" class="muted">- (empty queue) -</td></tr>
          {{/if}}
        </tbody>
      </table>
    </div>
  </div>
</section>
